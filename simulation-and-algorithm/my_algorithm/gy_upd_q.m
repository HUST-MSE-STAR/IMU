function [q1,dq]=gy_upd_q(w,w1,q)
global T;
R=[0 -w(1) -w(2) -w(3);
   w(1) 0 w(3) -w(2);
   w(2) -w(3) 0 w(1);
   w(3) w(2) -w(1) 0];
R1=[0 -w1(1) -w1(2) -w1(3);
   w1(1) 0 w1(3) -w1(2);
   w1(2) -w1(3) 0 w(1);
   w(3) w(2) -w(1) 0];    %R：前一刻的 R1:此刻的

k1=R*q/2;
k2=(R+R1)*(q+(T/2)*k1)/4;
k3=(R+R1)*(q+(T/2)*k2)/4;
k4=R1*(q+T*k3)/2;     %这四个式子是四阶龙格库塔那个，直接套用
k=(k1+2*k2+2*k3+k4)/6;   %预测的k 
dq=k;    %dq是给加速度计和磁力计做姿态解算更新的
q1=q+k*T;  %更新四元数
q1=q1/norm(q1,2);   %单位化
end
